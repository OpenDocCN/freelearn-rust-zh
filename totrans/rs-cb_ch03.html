<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis">
<head>
  <meta charset="UTF-8"/>
  <title>Deep Diving into Cargo</title>
  <link type="text/css" rel="stylesheet" media="all" href="style.css"/>
  <link type="text/css" rel="stylesheet" media="all" href="core.css"/>
</head>
<body>
  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Deep Diving into Cargo</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will cover the following recipes:</p>
<ul>
<li>Creating a new project using Cargo</li>
<li>Downloading an external crate from crates.io</li>
<li>Working on existing Cargo projects</li>
<li>Running tests with Cargo</li>
<li>Configuration management of the project</li>
<li>Building the project on the Travis CI</li>
<li>Uploading to crates.io</li>
</ul>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>Cargo is one of the unique selling points of Rust, which is the first of its kind in the system programming space. Cargo is Rust's package manager, and it makes a developer's life easy in regard to creating, developing, packaging, maintaining, testing, and deploying application code or tools to production, without great effort. In this chapter, we will cover recipes that will enable a developer to utilize all the features of Cargo and make a production-grade Rust application from day one of development.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating a new project using Cargo</h1>
                </header>
            
            <article>
                
<p>Cargo is a unique offering from Rust and is very new in the sphere of system programming. It is also one of the selling points of Rust, as it enables developers to package, ship, and test their Rust application.</p>
<p>We will cover a lot of functionalities of Cargo in this chapter.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>We require the Rust compiler, Cargo, and any text editor for coding.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Open the Terminal.</li>
<li>Go to the directory where you want to create the project:</li>
</ol>
<pre><strong>      cd project_location</strong>
</pre>
<ol start="3">
<li>Enter the following command to create a new Rust project:</li>
</ol>
<pre><strong>      cargo new project_name --bin</strong>
</pre>
<p style="padding-left: 60px">Create a project named <kbd>hello_world</kbd>, as shown in the following example:</p>
<pre><strong>      cargo new hello_world --bin</strong>
</pre>
<p style="padding-left: 60px">You should get the following output:</p>
<div class="CDPAlignCenter CDPAlign"><img height="29" width="482" src="images/3b17cd26-363d-47a8-84a9-838bc8711661.png"/></div>
<ol start="4">
<li>You should have a new folder created with the name of the project.</li>
</ol>
<p style="padding-left: 60px">First, get into the project and examine it:</p>
<pre><strong>      cd hello_world</strong><br/><strong>      tree .</strong>
</pre>
<p style="padding-left: 60px">You should get the following output:</p>
<div class="CDPAlignCenter CDPAlign"><img height="117" width="432" src="images/a5dc8dbc-18b3-45ab-8dc7-4e094c7d4062.png"/></div>
<p style="padding-left: 60px">This is the whole structure of the newly created project.</p>
<ol start="5">
<li>Print the content of the <kbd>Cargo.toml</kbd> file using the <kbd>cat</kbd> command in Linux:</li>
</ol>
<pre><strong>      cat Cargo.toml</strong>
</pre>
<p style="padding-left: 60px">You should get the following output:</p>
<div class="CDPAlignCenter CDPAlign"><img height="119" width="489" class="image-border" src="images/fd799fce-392e-489c-ac2c-e958fe9d2a4b.png"/></div>
<ol start="6">
<li>Go to the <kbd>src</kbd> directory inside the project where you will find the default <kbd>main.rs</kbd> file and print its content using the <kbd>cat</kbd> command in Linux:</li>
</ol>
<pre><strong>      cd src</strong><br/><strong>      cat main.rs</strong>
</pre>
<p style="padding-left: 60px">You should get the following output:</p>
<div class="CDPAlignCenter CDPAlign"><img height="102" width="507" src="images/ce80257d-ccc6-4036-88d5-226eb35e414e.png"/></div>
<ol start="7">
<li>Build the sample project that comes with the <kbd>cargo new</kbd> command:</li>
</ol>
<pre><strong>      cargo build</strong>
</pre>
<p style="padding-left: 60px">You should get the following output:</p>
<div class="CDPAlignCenter CDPAlign"><img height="44" width="620" class="image-border" src="images/5c519252-e025-470e-9fa4-c1e86cb9e4d7.png"/></div>
<ol start="8">
<li>The Cargo build will create a new directory named <kbd>target</kbd> and a file named <kbd>cargo.lock</kbd>.</li>
</ol>
<p style="padding-left: 60px">Run the compiled project, which is a executable file present in the target directory.</p>
<pre><strong>      . project_directory/target/debug/hello_world</strong>
</pre>
<p style="padding-left: 60px">Since this is an executable, you should be able to see the output of the application.</p>
<p style="padding-left: 60px">You should get the following output:</p>
<div class="CDPAlignCenter CDPAlign"><img height="76" width="592" src="images/fae32c88-7b4a-4aed-b76a-148cf0cbd9a3.png"/></div>
<ol start="9">
<li>We have to follow the preceding two steps in order to build the executable code and then execute the Rust application, but with the <kbd>cargo run</kbd> command we can perform both simultaneously:</li>
</ol>
<pre><strong>      cd project_location</strong><br/><strong>      cargo run</strong>
</pre>
<p style="padding-left: 60px">You should get the following output:</p>
<div class="CDPAlignCenter CDPAlign"><img height="59" width="491" src="images/4c35b8e5-eb65-41b2-93ba-56c606a1cc0f.png"/></div>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Cargo is a command-line tool that comes with the installation of Rust. It's essential for the following reasons:</p>
<ul>
<li>It introduces metadata files that convey all the details about the project</li>
<li>It calls the <kbd>rustc</kbd> compiler to build the project</li>
<li>It helps the developer structure and maintain the code better</li>
</ul>
<p>The <kbd>cargo new</kbd> commands create the complete folder structure for us. For our project, the <kbd>--bin</kbd> indicates the binary file. This means we are creating a Rust application that is expected to work out of the box in regard to solving a real-world problem. However, in this case, we created a library that would not use the <kbd>--bin</kbd> option as a command-line tool. Libraries are known as crates in Rust. We will create a crate in Rust later, in the upcoming chapters.</p>
<p><kbd>Cargo.toml</kbd> is a manifest file that contains all the <span>metadata that Cargo needs to compile your project. When you run the <kbd>cargo build</kbd> command, you will see that the source code is converted into an executable byte code, which would be the end application; this creates the</span> <kbd>target</kbd> directory and places the executable in the <kbd>debug</kbd> folder inside it. Inside the <kbd>debug</kbd> folder, we mainly have <kbd>deps</kbd> directory which contains the different dependent crates which were downloaded to execute the application.</p>
<p>Your project can optionally contain folders named <kbd>example</kbd>, <kbd>test</kbd>, and <kbd>bench</kbd>, which Cargo will treat as containing examples, integration tests, and benchmarks respectively.</p>
<p>Rust is very smart and only compiles when there are changes in the code.</p>
<div class="packt_infobox">Compiling <kbd>cargo build --release</kbd> <span>in debug mode is suitable for development, and its compilation time is shorter since the compiler does not do any optimizations and checks. However, when you run the code in release mode, it will take longer to compile, but the code will run faster in production. The release mode will prepare the build in the <kbd>release</kbd> folder inside <kbd>target</kbd> instead of <kbd>debug</kbd> directory.</span></div>
<p>We see that the build process created a <kbd>Cargo.lock</kbd> file. This file contains all the information about our dependencies. We will cover this file in detail in an upcoming recipe.</p>
<p>In order to compile multiple binaries in the same Rust project, we have to make certain entries in the <kbd>Cargo.toml</kbd> file where we explicitly mention the target that we want to build. By default, Cargo compiles the <kbd>main.rs</kbd> file in the <kbd>src</kbd> folder with the same name of the project, but for compiling multiple binaries, say <kbd>daemon</kbd> and <kbd>client</kbd>, which need to be built, we make the following mention changes in the <kbd>Cargo.toml</kbd> file:</p>
<pre class="mce-root">[[bin]]<br/>name = "daemon"<br/>path = "src/daemon/bin/main.rs"<br/><br/>[[bin]]<br/>name = "client"<br/>path = "src/client/bin/main.rs"
</pre>
<p>This would build an additional two binaries named <kbd>daemon</kbd> and <kbd>client</kbd>, along with the project binary.</p>
<div class="packt_tip">Similarly we can have sections such as<kbd>[lib]</kbd>, <kbd>[[bench]]</kbd>, <kbd>[[test]]</kbd>, and <kbd>[[example]]</kbd> in a configuration file to build libraries, benchmarks, tests, and examples.</div>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Downloading an external crate from crates.io</h1>
                </header>
            
            <article>
                
<p>To create complex applications for solving real-world problems, we need to reuse other open source projects and dependencies for faster development.</p>
<p>The <a href="https://crates.io/">https://crates.io/</a> is the Rust community's central repository that serves as a location for discovering and downloading packages. The command-line tool <strong><kbd>cargo</kbd></strong> is configured to find requested packages and download and use them. You will learn how to download and maintain external crates (dependencies) in this recipe.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>We require the Rust compiler, Cargo, and any text editor for coding.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Open the <kbd>Cargo.toml</kbd> file in your favorite text editor; in this recipe, we will use the <kbd>nano</kbd> editor:</li>
</ol>
<pre><strong>      nano Cargo.toml</strong>
</pre>
<p style="padding-left: 90px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="images/6051ead3-0ccc-4386-aeaa-2521cb2d287a.png"/></div>
<ol start="2">
<li>Add a <kbd>[dependencies]</kbd> <span>section to the <kbd>cargo.toml</kbd> file and enter</span> <span><kbd>time = "0.1.12"</kbd> and <kbd>regex = "0.1.41"</kbd> b</span>elow it.</li>
</ol>
<p style="padding-left: 60px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="129" width="326" class="image-border" src="images/b796fa21-2c3b-4cec-8373-624992ff2f0e.png"/></div>
<ol start="3">
<li>Use the <kbd>cat</kbd> command to see the configuration list:</li>
</ol>
<pre><strong>      cat Cargo.toml</strong>
</pre>
<p style="padding-left: 60px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="114" width="437" class="image-border" src="images/0e08a465-a5b1-4268-8108-4f528522de23.png"/></div>
<ol start="4">
<li>Build the project to pull the dependencies from <a href="https://crates.io/">https://crates.io/</a>:</li>
</ol>
<pre><strong>      cargo build</strong>
</pre>
<p style="padding-left: 60px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="351" width="550" src="images/1f0112ef-2dd0-47bd-a639-7435f462de6f.png"/></div>
<ol start="5">
<li>Use the existing crates pulled in our project.</li>
</ol>
<p style="padding-left: 60px">Open the <kbd>main.rs</kbd> file in the <kbd>src</kbd> directory using <kbd>nano</kbd> and enter the following code:</p>
<pre><strong>      nano main.rs</strong>
</pre>
<p style="padding-left: 60px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="60" width="520" src="images/a8670d72-1184-40aa-af86-3aa889e7e9d3.png"/></div>
<pre><span class="kw">        // Declare the external crate<br/>        extern</span> <span class="kw">crate</span> <span class="ident">regex</span>;<br/><span class="kw">        use</span> <span class="ident">regex</span>::<span class="ident">Regex</span>;<br/><span class="kw">        fn</span> <span class="ident">main</span>() {<br/>          <span class="kw">let</span> <span class="ident">check_date</span> <span class="op">=</span> <span class="ident">Regex</span>::<span class="ident">new</span>(<span class="string">r"^\d{4}-\d{2}-\d{2}$"</span>).<span class="ident">unwrap</span>();<br/>          <span class="macro">println</span><span class="macro">!</span>(<span class="string">"Did our date match? {}"</span>, <span class="ident">check_date</span>.<span class="ident">is_match</span>(<span class="string">"2017<br/>          -02-01"</span>));<br/>        }
</pre>
<p style="padding-left: 60px"><span>You should get the following state output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="127" width="368" class="image-border" src="images/f65fce94-30df-438c-b170-a280a3f699c6.png"/></div>
<ol start="6">
<li>Compile and run the project:</li>
</ol>
<pre><strong>      cargo run</strong> 
</pre>
<p style="padding-left: 60px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="71" width="508" class="image-border" src="images/f5eef42b-b7d7-4e98-bfc7-6e6a79251300.png"/></div>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>We enter the dependencies we require for the project in the <kbd>Cargo.toml</kbd> file. This file fetches us the package and version mentioned in the <a href="https://crates.io/">https://crates.io/</a> central repository. In the preceding recipe, we downloaded the time and regex crates and also mentioned the desired version that we would like to work on.</p>
<p>When we build a project after modifying the <kbd>Cargo.toml</kbd> file, it downloads all the modules inside the crate of our local development system and makes an entry in the <kbd>Cargo.lock</kbd> file, which would contain all the details about the downloaded dependencies.</p>
<div class="packt_tip">If you are planning to create a library or improve upon an existing library implementation, it is advisable that you check out whether there are any similar ideas or projects implemented in <a href="https://crates.io/">https://crates.io/</a> to evaluate the value of your open project. All the projects put up on the <a href="https://crates.io/">https://crates.io/</a> repository are open source projects available on GitHub.</div>
<p>The fun part about using other dependencies is that you get to reuse the available working version of an application or function you would like to use in the project and reduce your project development time.</p>
<p>We used the <kbd>extern crate</kbd> command in our Rust script to call the downloaded crates.</p>
<p><span><kbd>extern crate regex</kbd> or crate and import all its functions inside the modules it has. We then call them in the code by passing our data.</span></p>
<p>In the preceding code snippet, we explicitly mentioned the need for using the <kbd>use</kbd> command to call the <kbd>Regex</kbd> module in the <kbd>regex</kbd> crate using <kbd>regex::Regex</kbd> and checking whether the dates match and print the Boolean value in the terminal.</p>
<p>We call the <kbd>unwrap</kbd> and <kbd>is_match</kbd> functions to check whether both the strings are the same or not. We return <kbd>true</kbd> if they are similar and <kbd>false</kbd> if they are not.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Working on existing Cargo projects</h1>
                </header>
            
            <article>
                
<p>Cargo is a tool that allows the Rust application to declare their various dependencies to ensure that you will able to recreate the build by following the same dependencies and version.</p>
<p>At a higher level, it offers configuration management to the Rust project and helps in reproducing the development environment. Usually, in other languages, it's a very tedious and time-consuming process to maintain the different dependencies and configure them each and every time we deploy the application in a different environment.</p>
<p>Cargo provides features out of the box which enables developers and project managers to ship/deploy Rust projects/applications very quickly and without much <span>hassle</span>; this is a very big advantage over other languages.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>We require the Rust compiler, Cargo, and any text editor for coding.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Clone the project from the project repo in this recipe. Close the <kbd>rand</kbd> crate from GitHub where it is hosted. Do this by typing the following command in the terminal:</li>
</ol>
<pre><strong>      git clone https://github.com/rust-lang-nursery/rand.git</strong>
</pre>
<p style="padding-left: 60px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="88" width="606" class="image-border" src="images/79c2d53c-b3f6-4d0f-a16d-3982f2b1324d.png"/></div>
<p style="padding-left: 60px">This would clone the repo from the GitHub to the local system.</p>
<ol start="2">
<li>Enter the newly created project <kbd>rand</kbd> and check out the complex production-level package details:</li>
</ol>
<pre><strong>      cd rand/</strong><br/><strong>      tree .</strong>
</pre>
<p style="padding-left: 60px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="436" width="289" class="image-border" src="images/536d9e70-2807-4680-ba72-03e76860cd04.png"/></div>
<ol start="3">
<li>Build the project using the Cargo build command:</li>
</ol>
<pre><strong>      cargo build</strong> 
</pre>
<p style="padding-left: 60px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="83" width="444" src="images/a9b328bc-4e9a-4b23-9aa2-af02a4ebf30d.png"/></div>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The preceding three steps would set up a complete Rust project in your local development environment. This is the power of the Cargo command-line tool, which makes the post- development application life cycle so easy for a developer.</p>
<p>Here, we have basically cloned an existing project and built it. Cargo looked into the manifest file to fetch all the metadata that was required to understand the various dependencies of the project and build them.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Running tests with Cargo</h1>
                </header>
            
            <article>
                
<p>Tests are important for complex production-grade applications as they validate the working of a functional unit of the project. Cargo provides Rust with all the testing functionalities that help in unit and integration tests out of the box.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>We require the Rust compiler, Cargo, and any text editor for coding.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Run the <kbd>cargo test</kbd> command inside the project:</li>
</ol>
<pre><strong>      cargo test</strong>
</pre>
<p style="padding-left: 60px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="115" width="587" class="image-border" src="images/9e559e26-ec7d-4bb6-b031-11e7e88e7ae0.png"/></div>
<ol start="2">
<li>Mention the name to run a particular test-- <kbd>cargo test test_name</kbd>:</li>
</ol>
<pre><strong>      cargo test foo</strong>
</pre>
<p style="padding-left: 60px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="99" width="481" class="image-border" src="images/b1b65b95-746d-4ddc-a7cc-b4ade4c82414.png"/></div>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Cargo looks for tests to run in two places: they are in the <kbd>src</kbd> directory, where we can have our unit tests' code placed, and the <kbd>tests</kbd> directory, where we place the integration tests.</p>
<p>In this recipe, we did not have any tests for the project, but we have a dedicated chapter for tests later, where we will deep dive into the various aspects of testing.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuration management of the project</h1>
                </header>
            
            <article>
                
<p>We will thoroughly explore the use of <kbd>Cargo.lock</kbd> and <kbd>Cargo.toml</kbd> in this recipe and we'll see how they help in configuration management.</p>
<p>Configuration management here refers to the ability to have version control, which includes uploading and downloading the desired version of your project dependencies.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>We require the Rust compiler, Cargo, and any text editor for coding.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Go to the <kbd>hello_world</kbd> project and enter the GitHub repo link of the <kbd>rand</kbd> library in the <kbd>Cargo.toml</kbd> file:</li>
</ol>
<pre><strong>      cd hello_world</strong><br/><strong>      nano Cargo.toml</strong>
</pre>
<p style="padding-left: 60px">In the following <kbd>Cargo.toml</kbd>, enter the mentioned dependencies:</p>
<pre><strong>      rand = { git = "https://github.com/rust-lang-nursery/rand.git"<br/>      }</strong>
</pre>
<p style="padding-left: 60px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="163" width="453" class="image-border" src="images/888b1472-3683-4d04-b400-6219e1e330da.png"/></div>
<ol start="2">
<li>In the same <kbd>Cargo.toml</kbd> file, enter <kbd>rev</kbd> and the <kbd>SHA</kbd> value for the <kbd>rand</kbd> crate.</li>
</ol>
<p style="padding-left: 60px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="147" width="599" class="image-border" src="images/5ce3e951-eab1-481a-af2b-78933a648990.png"/></div>
<ol start="3">
<li>Type the <kbd>cargo update</kbd> command to implement the new changes:</li>
</ol>
<pre><strong>      cargo update</strong>
</pre>
<p style="padding-left: 60px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="45" width="540" src="images/037b0a26-c710-4b81-9665-7869631b5969.png"/></div>
<ol start="4">
<li>Enter <kbd>Cargo.lock</kbd> and look through the <kbd>rand</kbd> package details.</li>
</ol>
<p style="padding-left: 60px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="95" width="723" class="image-border" src="images/9e0d7eab-a66c-4f71-8328-57788d72b405.png"/></div>
<div class="packt_infobox">Never make any manual changes in the <kbd>Cargo.lock</kbd> file. It is not intended to be edited manually.</div>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Cargo parses through the manifest file data, and, based on the data entered, it performs certain tasks.</p>
<p>First, we entered the GitHub repo link of the project in the <kbd>Cargo.toml</kbd> file to install the particular crate. Since we did not mention any other detail--for example, which version--Cargo will pull all the modules and resources of the latest commit to the master branch of the project.</p>
<p>However, the problem with this approach is that, if the project changes its layout or code tomorrow, our current implementation may be affected when we update the package.</p>
<p>To avoid this, we assigned the <kbd>rev</kbd> value to the commit ID of the project whose resource we have used for our current build. This seems to solve our problem, but we still have to remember the commit ID, which is error-prone when we enter a wrong ID.</p>
<p>Enter <kbd>Cargo.lock</kbd> using the <kbd>nano</kbd> command. Since the <kbd>lock</kbd> file exists, we don't need to manually keep track of the revision of the dependencies. Cargo will create entries in the <kbd>Cargo.lock</kbd> file with the details of the revision for each package used in the application.</p>
<p>When you build for the first time, Cargo will take the latest commit and write that information to <kbd>Cargo.lock</kbd>. Imagine that we are shipping the project to a new host where we want to configure the Rust application. Cargo will use the exact <kbd>SHA</kbd> from the <kbd>Cargo.lock</kbd> file even though you should not have mentioned it in the <kbd>Cargo.toml</kbd> file. We can see there is a lot of information about the package in the <kbd>lock</kbd> file, which will help us reproduce the same dependencies later.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Building the project on the Travis CI</h1>
                </header>
            
            <article>
                
<p>Travis CI is a continuous integrated software that reads the <kbd>yml</kbd> file in your project repository. It provides instructions or commands to the tools on how you should build, test, and ship.</p>
<p>In this recipe, you will learn how to build a Rust application using the <kbd>TravisCI</kbd> tool whose code is hosted on GitHub.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>We require the Rust compiler, Cargo, and any text editor for coding. Host the Rust application in a GitHub repo and integrate the <kbd>TravisCI</kbd> tool to the GitHub repo.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Create a <kbd>.travis.yml</kbd> file in the project using the <kbd>touch</kbd> command:</li>
</ol>
<pre><strong>      cd project_location <br/>      touch .travis.yml  </strong>
</pre>
<ol start="2">
<li>Enter the following configuration for testing the application in different Rust builds by opening the file using any text editor; we are using <kbd>nano</kbd> in this recipe:</li>
</ol>
<pre><strong>      nano .travis.yml</strong>
</pre>
<pre><span class="ident">        language</span>: <span class="ident">rust</span><br/><span class="ident">        rust</span>:<br/>          <span class="op">-</span> <span class="ident">stable</span><br/>          <span class="op">-</span> <span class="ident">beta</span><br/>          <span class="op">-</span> <span class="ident">nightly</span><br/><span class="ident">        matrix</span>:<br/>          <span class="ident">allow_failures</span>:<br/>          <span class="op">-</span> <span class="ident">rust</span>: <span class="ident">nightly</span>
</pre>
<p style="padding-left: 60px"><span>You should get the following output:</span></p>
<div class="CDPAlignCenter CDPAlign"><img height="131" width="434" src="images/032afcbc-7057-416c-924b-8783879c2a02.png"/></div>
<ol start="3">
<li>Make a change in the project and push the project to the GitHub repo.</li>
</ol>
<div class="packt_infobox">The <kbd>build</kbd> process is triggered on TravisCI platform each and every time we push a commit in the project repository. This process is configurable by the advance options available in the TravisCI platform, where you can schedule the build or select repo branches to build from.</div>
<p style="padding-left: 60px">You should get the following screenshot as output in the Travis CI platform:</p>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="images/412c70cd-313e-4df3-8fa0-30a8802780ca.png"/></div>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Travis CI tools read the instruction specified in the <kbd>.travis.yml</kbd> file of the project and prepare the environment in which you want to build, test, and release the project.</p>
<p>In the next section, we will break down and understand what each of the commands does in the <kbd>build</kbd> pipeline:</p>
<pre><strong>      language: rust</strong>
</pre>
<p>This downloads and installs the latest stable version of the Rust release when setting up the machine. If you only want to test the application in a stable version, you just need the preceding command and there is no need to specify the versions:</p>
<pre>rust:<br/> - stable<br/> - beta<br/> - nightly
</pre>
<p>For specifying the versions in which you want to test the application, you can use the preceding command where you built the project in the <kbd>beta</kbd> and <kbd>nightly</kbd> channels. Even if you are only targeting stable, the Rust team encourages you to test it on other channels as well:</p>
<pre>matrix:<br/> allow_failures:<br/> - rust: nightly
</pre>
<p>This will test all three channels, and any breakage in <kbd>nightly</kbd> will not fail your overall build.</p>
<p>In the preceding <kbd>build</kbd> logs, if you look closely, you will see the default test script is run by the Travis CI, and it uses the Cargo tool to run your build and test the application using <kbd>cargo build</kbd> and <kbd>cargo test</kbd> commands.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Uploading to crates.io</h1>
                </header>
            
            <article>
                
<p>The <a href="https://crates.io/">https://crates.io/</a> is a website that acts as a central repository for hosting all the crates made by the amazing Rust community. It contains various projects of various domains.</p>
<p>This helps in instantly publishing the crate and installing them.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>We require the Rust compiler, Cargo, and any text editor to code and create an account on the <a href="https://crates.io/">https://crates.io/</a> website using the GitHub ID.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Go to the project location from where you want to upload your project to <a href="https://crates.io/">https://crates.io/</a>:</li>
</ol>
<pre><strong>      cd project_location</strong>
</pre>
<ol start="2">
<li>The <a href="https://crates.io/">https://crates.io/</a> provides an API token on the accounts setting page when you create a new account or log in with your existing GitHub ID:</li>
</ol>
<pre><strong>      cargo login API_TOKEN</strong>
</pre>
<ol start="3">
<li>Package the Rust application:</li>
</ol>
<pre><strong>      cargo package</strong>
</pre>
<ol start="4">
<li>Publish the Rust application to <a href="https://crates.io/">https://crates.io/</a>:</li>
</ol>
<pre><strong>      cargo publish</strong>
</pre>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The Cargo login command takes the API token provided and stores it in the <kbd>~/.cargo/config</kbd> location.</p>
<div class="packt_infobox">Note that the API token should be kept secret and should not be shared, as it is the way by which we can manage the crates uploaded.</div>
<p>Keep in mind that the name that you used to create the project is going to be the name of the crate, and names of crates are based on a first come, first served basis.</p>
<p>When our project is ready to be packaged, we use the preceding step to create a new folder, named <kbd>/target/package</kbd>.</p>
<div class="highlight">
<p>The content inside the package is what is going to be uploaded to the <a href="https://crates.io/">https://crates.io/</a> website. There will be a file with the naming convention <kbd>project_name-version.crate</kbd> and a folder <span><kbd>project_name-version</kbd>. These names are based on the information given by the developer to <kbd>cargo.toml</kbd></span>. We can tweak the value in the configuration file and use the package command until we get the correct name and version number.</p>
<p>In packaging, we have to make sure that we do not upload unnecessary files, such as test script or text files and so on, which were used for testing the library. For this purpose, the <kbd>*.crate</kbd> file provides a lot of tags or keys that tell about the various features, examples, and resources of the file:</p>
<pre>[package]<br/># ...<br/>exclude = [    <br/>  "public/assets/*",  <br/>  "videos/*",<br/>]<br/><br/># ...<br/>include = [ <br/>  "**/*.rs", <br/>  "Cargo.toml",<br/>]
</pre>
<p>In the preceding section, we explicitly mentioned that all the resources in the <kbd>assets</kbd> and <kbd>videos</kbd> folders be excluded; on the other hand, we had a tag named <kbd>include</kbd> that will help to make sure all the important files are packaged.</p>
<p>The final command, <kbd>cargo publish</kbd>, looks into the <kbd>*.crate</kbd> file and publishes the crate in the account created.</p>
</div>


            </article>

            
        </section>
    </div>
</body>
</html>