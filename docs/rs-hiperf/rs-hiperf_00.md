# 前言

欢迎来到《Rust 高性能编程》。在这本书中，你将通过学习如何提高你的 Rust 代码性能来获得对高性能编程的温和介绍。它将向你展示如何通过避免常见瓶颈正确地将代码从其他语言转换过来，以及如何使用一些惯用的 Rust API 轻松提高你应用程序的性能。

通过找到能提高开发效率并改善你应用程序性能的优秀 crate，你将了解伟大的 Rust 社区。你将编写示例来使用你所有的知识。你将编写自己的宏和自定义 derives，并学习关于异步和多线程编程。

# 本书面向的对象

在这本书中，你将找到提高你的 Rust 代码性能所需的一切；你将学会许多技巧，并使用有用的 crate 和工具。因此，本书的编写基于你已经具备一些 Rust 编程知识的基础。

本书不会涵盖高性能编程的整个世界，因为这是一个极其广泛的话题。你将找到对大多数通用高性能编程概念的温和介绍，并学习如何在 Rust 编程语言中使用特定的模式。

# 本书涵盖的内容

第一章，*常见的性能陷阱*，帮助你了解从 C/C++等语言转换过来可能导致性能大幅下降的原因，如何使用不同的 Copy/Clone 类型和引用来改进你的算法，以及了解循环复杂度如何使编译器优化变得不那么有效。

第二章，*额外的性能提升*，进一步探讨了 Rust 为我们提供的提高应用程序性能的一些技巧和窍门。在了解了前几章中常见的错误之后，你将学习如何利用 Rust 类型系统为你带来优势，创建复杂的编译时检查和评估。你还将了解常见标准库集合之间的区别，以便为你的算法选择正确的集合。

第三章，*Rust 中的内存管理*，展示了如何通过利用借用检查器来提高你应用程序的内存占用。你将了解生命周期以及如何正确使用它们，理解有助于你的数据在内存中正确结构化的不同表示属性，最后，学习如何使用标准库类型为你的应用程序创建高效的共享指针结构。

第四章，*代码检查与 Clippy*，教你了解代码检查的强大功能以及如何配置它们以提供适当的建议。你将学习如何配置 Clippy，这是一个功能强大的工具，能够指出常见的错误和潜在的性能改进。在本章中，你将了解最重要的 Clippy 代码检查，并在你的开发工作流程中使用它们。

第五章，*分析你的 Rust 应用程序*，介绍了如何使用分析软件，以便你可以轻松地找到应用程序中的性能瓶颈。你将了解缓存未命中如何影响你的代码，以及如何在代码中找到应用程序花费更多时间的地方。你将学会修复这些瓶颈，从而提高应用程序的整体性能。

第六章，*基准测试*，讨论了如何检测性能关键代码以及如何在 Rust 稳定版和夜间版中对其进行基准测试。你还将学习如何设置你的持续集成环境以获取性能报告，并在你的项目开发过程中跟踪它们。

第七章，*内置宏和配置项*，带你进入可以个性化你的代码的属性的世界，这样你可以使用代码的每一部分针对特定的平台，利用每个平台的所有潜力。你将了解如何划分你的库，以便不是所有的代码都必须为每个用途编译，你最终将学习如何使用夜间功能来提高你代码的效率和需要编写的代码量。

第八章，*必备宏库*，介绍了多个元编程库——创建可序列化的结构，从 JSON 或 TOML 等语言中反序列化数据，解析日志文件，或者为你的数据结构创建大量的代码模板。在这里，你可以了解如何初始化复杂的静态结构，并使用适当的错误处理。最后，得益于夜间 Rust 和插件，你将能够创建一个带有数据库的小型 Web 服务器，甚至可以连接到它存在的最快的模板系统。

第九章，*创建自己的宏*，介绍了如何编写自己的宏以避免代码冗余。你将了解新的宏 1.1 版本的工作原理，并创建你的第一个自定义派生。最后，你将学习编译器插件是如何在内部工作的，并将创建你自己的编译器插件。

第十章，*多线程*，概述了如何创建多个线程以平衡应用程序的工作。您将了解 Rust 线程的全部功能和标准库中的同步原语。此外，您还将学习如何在线程之间发送信息。最后，您将了解一些有用的 crate，这些 crate 可以帮助您实现工作窃取算法、并行迭代器等。

第十一章，*异步编程*，帮助您了解异步编程是如何工作的。在这里，您可以通过 mio 和 futures 学习如何在 Rust 中开发异步算法，并学习新的 async/await 语法。您还可以使用 tokio 和 WebSockets 创建异步应用程序。

# 要充分利用本书

本书假设您对 Rust 编程语言有一些基本了解。如果您是 Rust 的新手，官方 Rust 书籍的前几章是一个很好的序言。尽管如此，您应该至少对一种编程语言有适度的或深入的了解；还需要具备终端使用的基本知识。

具备计算机架构的基本知识以及 C/C++高性能编程的基本知识将是一个加分项，尽管它们不是必需的，因为在这本书中，我们将涵盖所有基础理论，以了解幕后性能改进的工作原理。

您需要代码编辑器或 IDE 来遵循本书。Rust 已经在 Microsoft 的 Visual Studio Code、GitHub 的 Atom 和 IntelliJ 的 IDEA IDE 中进行了大量测试。我个人使用 Atom 编写代码示例，但请随意使用您喜欢的文本编辑器或 IDE。您可能会在您的编辑器中找到插件或扩展。

在 VS Code、Atom 和 IntelliJ IDEA 的情况下，您将找到官方的 Rust 包以及非官方的扩展。我个人一直在使用 Atom 的 Tokamak 包。

# 下载示例代码文件

您可以从[www.packtpub.com](http://www.packtpub.com)的账户下载本书的示例代码文件。如果您在其他地方购买了这本书，您可以访问[www.packtpub.com/support](http://www.packtpub.com/support)并注册，以便将文件直接通过电子邮件发送给您。

您可以通过以下步骤下载代码文件：

1.  在[www.packtpub.com](http://www.packtpub.com/support)登录或注册。

1.  选择支持选项卡。

1.  点击代码下载与勘误。

1.  在搜索框中输入书籍名称，并遵循屏幕上的说明。

文件下载完成后，请确保使用最新版本的以下软件解压缩或提取文件夹：

+   WinRAR/7-Zip for Windows

+   Zipeg/iZip/UnRarX for Mac

+   7-Zip/PeaZip for Linux

书籍的代码包也托管在 GitHub 上，网址为 [`github.com/PacktPublishing/Rust-High-Performance`](https://github.com/PacktPublishing/Rust-High-Performance)。如果代码有更新，它将在现有的 GitHub 仓库中更新。

我们还有其他来自我们丰富的书籍和视频目录的代码包，可在 **[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)** 上找到。查看它们吧！

# 使用的约定

本书使用了多种文本约定。

`CodeInText`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“迭代器将在您调用`collect()`方法或将其用于循环之前不会运行。这些就是在`next()`方法执行的时刻。”

代码块设置如下：

```rs
    for row in arr1.iter().cartesian_product(arr2.iter()) {
      print!("{:?}, ", row);
    }
```

任何命令行输入或输出都应如下所示：

```rs
cargo install --no-default-features --features sqlite diesel_cli
```

**粗体**：表示新术语、重要单词或您在屏幕上看到的单词。

警告或重要说明看起来是这样的。

小技巧和技巧看起来是这样的。

# 联系我们

我们欢迎读者的反馈。

**一般反馈**：请通过 `feedback@packtpub.com` 发送电子邮件，并在邮件主题中提及书籍标题。如果您对本书的任何方面有疑问，请通过 `questions@packtpub.com` 发送电子邮件给我们。

**勘误**: 尽管我们已经尽最大努力确保内容的准确性，但错误仍然可能发生。如果您在这本书中发现了错误，如果您能向我们报告，我们将不胜感激。请访问 [www.packtpub.com/submit-errata](http://www.packtpub.com/submit-errata)，选择您的书籍，点击勘误提交表单链接，并输入详细信息。

**盗版**: 如果您在互联网上以任何形式遇到我们作品的非法副本，如果您能提供位置地址或网站名称，我们将不胜感激。请通过 `copyright@packtpub.com` 联系我们，并附上材料的链接。

**如果您有兴趣成为作者**：如果您在某个领域有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问 [authors.packtpub.com](http://authors.packtpub.com/)。

# 评论

请留下评论。一旦您阅读并使用了这本书，为什么不在您购买它的网站上留下评论呢？潜在读者可以查看并使用您的客观意见来做出购买决定，Packt 公司可以了解您对我们产品的看法，我们的作者也可以看到他们对书籍的反馈。谢谢！

想了解更多关于 Packt 的信息，请访问 [packtpub.com](https://www.packtpub.com/)。
