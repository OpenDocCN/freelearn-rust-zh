# 前言

现代软件堆栈在规模和复杂性上正在迅速演变。如云计算、网络、数据科学、机器学习、DevOps、容器、物联网、嵌入式系统、分布式账本、虚拟和增强现实以及人工智能等技术领域持续发展和专业化。这导致系统软件开发者严重短缺，他们能够构建系统基础设施组件。现代社会、企业和政府越来越依赖数字技术，这更加重视开发安全、可靠和高效的系统软件和软件基础设施，这些是现代网络和移动应用程序所依赖的。

系统编程语言如 C/C++ 在这个领域已经证明了几十年，提供了高度的控制力和性能，但这是以牺牲内存安全为代价的。

高级语言如 Java、C#、Python、Ruby 和 JavaScript 提供了内存安全，但提供了较少的内存布局控制，并且遭受垃圾回收暂停的困扰。

Rust 是一种现代的开源系统编程语言，它承诺提供三个世界的最佳之处：Java 的类型安全；C++ 的速度、表达性和效率；以及没有垃圾回收器的内存安全。

这本书采用了一种独特的三步法来教授 Rust 中的系统编程。本书的每一章都从 Unix-like 操作系统（Unix/Linux/macOS）中该主题的系统编程基础和内核系统调用概述开始。然后，你将学习如何使用 Rust 标准库以及在某些情况下使用外部 crate 执行常见系统调用，使用大量的代码片段。然后，通过一个你将构建的实际示例项目来巩固这些知识。最后，每一章都有问题来巩固学习。

在这本书的结尾，你将有一个坚实的理解，了解如何使用 Rust 来管理和控制操作系统资源，如内存、文件、进程、线程、系统环境、外围设备、网络接口、终端和外壳，并且你会了解如何通过 FFI 构建跨语言绑定。在这个过程中，你将学习如何使用行业工具，并深刻理解 Rust 为构建安全、高效、可靠和系统级软件带来的价值。

# 本书面向的对象

这本书的目标读者是对 Rust 有基本了解但几乎没有系统编程或经验的程序员。这本书也适合有系统编程背景并希望将 Rust 作为 C/C++ 替代方案的人。

读者应该对任何语言的编程概念有一个基本的理解，例如 C、C++、Java、Python、Ruby、JavaScript 或 Go。

# 本书涵盖的内容

*第一章*, *行业工具 – Rust 工具链和项目结构*，介绍了 Rust 工具链用于构建和依赖管理、自动化测试和文档。

*第二章*, *Rust 编程语言之旅*，通过一个示例项目展示了 Rust 编程语言的关键概念，包括类型系统、数据结构和内存管理基础。

*第三章*, *Rust 标准库简介*，介绍了 Rust 标准库的关键模块，这些模块提供了系统编程的基础构建块和预定义功能。

*第四章*, *管理环境、命令行和时间*，涵盖了围绕如何通过编程方式处理命令行参数、设置和操作进程环境以及与系统时间工作的几个基础主题。

*第五章*, *Rust 中的内存管理*，全面审视了 Rust 提供的内存管理功能。我们将回顾 Linux 内存管理基础知识、C/C++的传统缺点以及 Rust 如何克服这些缺点。

*第六章*, *在 Rust 中处理文件和目录*，帮助你理解 Linux 文件系统的工作原理，以及如何掌握 Rust 标准库以应对文件和目录操作的各种场景。

*第七章*, *在 Rust 中实现终端 I/O*，帮助你理解伪终端应用程序的工作原理以及如何创建一个。结果将是一个处理流的交互式应用程序。

*第八章*, *处理进程和信号*，解释了进程是什么，如何在 Rust 中处理它们，如何创建和与子进程通信，以及如何处理信号和错误。

*第九章*, *管理并发*，以 Rust 的惯用方式解释了并发的基础知识以及跨线程共享数据的各种机制，包括通道、互斥锁和引用计数器。

*第十章*, *处理设备 I/O*，解释了 Linux I/O 概念，如缓冲、标准输入输出和设备 I/O，并展示了如何使用 Rust 控制 I/O 操作。

*第十一章*, *学习网络编程*，解释了如何在 Rust 中与低级网络原语和协议一起工作，通过构建低级 TCP 和 UDP 服务器和客户端以及反向代理来展示。 

*第十二章*，“编写不安全 Rust 和 FFI”，描述了与不安全 Rust 相关的关键动机和风险，并展示了如何使用 FFI 安全地将 Rust 与其他编程语言接口。

# 要充分利用本书

Rustup 必须在您的本地开发环境中安装。使用此链接进行安装：[`github.com/rust-lang/rustup`](https://github.com/rust-lang/rustup)。

请参阅以下链接以获取官方安装说明：[`www.rust-lang.org/tools/install`](https://www.rust-lang.org/tools/install)。

安装后，使用以下命令检查`rustc`和`cargo`是否已正确安装：

```rs
rustc --version 
cargo –version
```

您可以使用 Linux、macOS 或 Windows。

尽管 Rust 标准库在很大程度上是平台无关的，但本书的一般风格是面向基于 Linux/Unix 的系统。因此，在少数章节（或章节中的某些部分）中，建议使用本地 Linux 虚拟机，如 Virtual box，(或者如果您有云虚拟机，您也可以使用它)来运行章节中的代码。这可能是因为示例代码和项目中使用的命令、外部 crate 或共享库可能是 Linux/Unix 特定的。

有关在 Windows 上进行开发的说明

某些章节需要运行类似 Unix OS 的虚拟机或 Docker 镜像。

每一章中都有两种类型的代码，这些代码放置在本书的 Packt GitHub 仓库中：

+   与章节中命名的源文件中引用的示例项目对应的代码

+   独立的代码片段，放置在每个章节的`miscellaneous`文件夹中（如果适用）

如果您使用的是本书的数字版，我们建议您亲自输入代码或通过 GitHub 仓库（下一节中提供链接）访问代码。这样做将有助于您避免与代码复制和粘贴相关的任何潜在错误。

当使用`cargo run`命令构建和运行 Rust 程序时，如果运行命令的用户 ID 没有足够的权限执行系统级操作（如读取或写入文件），您可能会遇到'权限被拒绝'的消息。在这种情况下，可以使用以下命令之一作为解决方案来运行程序：

```rs
sudo env "PATH=$PATH" cargo run
```

# 下载示例代码文件

您可以从[www.packt.com](http://www.packt.com)的账户下载本书的示例代码文件。如果您在其他地方购买了本书，您可以访问[www.packtpub.com/support](http://www.packtpub.com/support)并注册，以便将文件直接通过电子邮件发送给您。

您可以通过以下步骤下载代码文件：

1.  在 [www.packt.com](http://www.packt.com) 登录或注册。

1.  选择**支持**标签。

1.  点击**代码下载**。

1.  在**搜索**框中输入本书的名称，并遵循屏幕上的说明。

下载文件后，请确保使用最新版本的软件解压缩或提取文件夹：

+   Windows 上的 WinRAR/7-Zip

+   Mac 上的 Zipeg/iZip/UnRarX

+   Linux 上的 7-Zip/PeaZip

本书代码包也托管在 GitHub 上，网址为[`github.com/PacktPublishing/Practical-System-Programming-for-Rust-Developers`](https://github.com/PacktPublishing/Practical-System-Programming-for-Rust-Developers)。如果代码有更新，它将在现有的 GitHub 仓库中更新。

我们还有其他来自我们丰富图书和视频目录的代码包，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。查看它们吧！

注意

本书中的代码片段是为了学习而设计的，并不旨在具有生产质量。因此，虽然代码示例是实用的，并使用了惯用的 Rust，但它们可能不会具有完整的功能，并且不会涵盖所有类型的边缘情况。这是有意为之，以免阻碍学习过程。

# 下载彩色图像

我们还提供了一份包含本书中使用的截图/图表彩色图像的 PDF 文件。您可以从这里下载：[`static.packt-cdn.com/downloads/9781800560963_ColorImages.pdf`](https://static.packt-cdn.com/downloads/9781800560963_ColorImages.pdf)。

# 使用的约定

本书使用了多种文本约定。

`文本中的代码`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“我们可以从`Utc`模块中访问`now()`函数来打印当前日期和时间。”

代码块是这样设置的：

```rs
fn main() {
    println!("Hello, time now is {:?}", chrono::Utc::now());
}
```

当我们希望您注意代码块中的特定部分时，相关的行或项目将以粗体显示：

```rs
fn main() {
    println!("Hello, time now is {:?}", chrono::Utc::now());
}
```

任何命令行输入或输出都应如下编写：

```rs
rustup toolchain install nightly
```

**粗体**：表示新术语、重要单词或您在屏幕上看到的单词。例如，菜单或对话框中的单词在文本中显示如下。以下是一个示例：“您将在控制台看到**Hello, world!**打印出来。”

小贴士或重要注意事项

看起来是这样的。

# 联系我们

我们欢迎读者的反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请在邮件主题中提及书名，并通过 customercare@packtpub.com 给我们发邮件。

**勘误**：尽管我们已经尽最大努力确保内容的准确性，但错误仍然可能发生。如果您在这本书中发现了错误，如果您能向我们报告，我们将不胜感激。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)，选择您的书，点击勘误提交表单链接，并输入详细信息。

**盗版**：如果您在互联网上遇到任何形式的我们作品的非法副本，如果您能提供位置地址或网站名称，我们将不胜感激。请通过 mailto:copyright@packt.com 与我们联系，并提供材料的链接。

**如果您有兴趣成为作者**：如果您在某个领域有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com)。

# 评论

请留下评论。一旦您阅读并使用了这本书，为何不在您购买它的网站上留下评论呢？潜在读者可以查看并使用您的客观意见来做出购买决定，我们 Packt 可以了解您对我们产品的看法，我们的作者也可以看到他们对书籍的反馈。谢谢！

如需了解 Packt 的更多信息，请访问[packt.com](http://packt.com)。
